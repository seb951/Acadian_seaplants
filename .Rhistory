temp[1:20,1:5]
temp = asv.filt.abundants.norm.FAMILY[order(rowSums(asv.filt.abundants.norm.FAMILY[,2:11],na.rm=T),decreasing = T),]
temp[is.na(temp[,1]),1] = "unknown"
temp[1:20,1:5]
dev.new()
p=ggplot() + labs(title = "bacteria",fill = "Taxonomy (family)",y ="Relative abundance of ASVs") +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5, size=14, face="bold")) +
geom_bar(aes(y = fraction, x = treatment, fill = taxonomy),
data = barplot.data,stat="identity")
p + scale_fill_brewer(palette = "Set3") + facet_grid(rows=vars(soilroot))
dev.print(device=pdf, "figures/Figure4a_FAMILY_barplots_bacteria.pdf", onefile=FALSE)
dev.off()
temp = asv.filt.abundants.norm.FAMILY[order(rowSums(asv.filt.abundants.norm.FAMILY[,2:11],na.rm=T),decreasing = T),]
temp[is.na(temp[,1]),1] = "unknown"
asv.filt.abundants.norm.FAMILY.top10 = temp[1:10,]
barplot.data = as.data.frame(unlist(asv.filt.abundants.norm.FAMILY.top10[,2:11]))
colnames(barplot.data)[1] = "fraction"
n = nrow(asv.filt.abundants.norm.FAMILY.top10)
barplot.data$treatment = factor(c(rep("control",n),rep("fertilization",n),rep("tomato",n),rep("pepper",n),rep("non-planted",n),rep("planted",n),rep("fertilization",n),rep("control",n),rep("tomato",n),rep("pepper",n)),levels=c('control','fertilization','tomato','pepper','planted','non-planted'))
barplot.data$taxonomy = unlist(rep(asv.filt.abundants.norm.FAMILY.top10[,1],ncol(asv.filt.abundants.norm.FAMILY.top10)-1))
barplot.data$soilroot = c(rep("soil",10*6), rep("root",10*4))
###ggplot
dev.new()
p=ggplot() + labs(title = "bacteria",fill = "Taxonomy (family)",y ="Relative abundance of ASVs") +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5, size=14, face="bold")) +
geom_bar(aes(y = fraction, x = treatment, fill = taxonomy),
data = barplot.data,stat="identity")
p + scale_fill_brewer(palette = "Set3") + facet_grid(rows=vars(soilroot))
dev.print(device=pdf, "figures/Figure4a_FAMILY_barplots_bacteria.pdf", onefile=FALSE)
dev.off()
?colorRampPalette
dim(temp)
dim(asv.filt.abundants.norm.FAMILY.top10)
temp = asv.filt.abundants.norm.FAMILY[order(rowSums(asv.filt.abundants.norm.FAMILY[,2:11],na.rm=T),decreasing = T),]
temp[is.na(temp[,1]),1] = "unknown"
asv.filt.abundants.norm.FAMILY.top10 = temp[1:20,]
barplot.data = as.data.frame(unlist(asv.filt.abundants.norm.FAMILY.top10[,2:11]))
colnames(barplot.data)[1] = "fraction"
n = nrow(asv.filt.abundants.norm.FAMILY.top10)
barplot.data$treatment = factor(c(rep("control",n),rep("fertilization",n),rep("tomato",n),rep("pepper",n),rep("non-planted",n),rep("planted",n),rep("fertilization",n),rep("control",n),rep("tomato",n),rep("pepper",n)),levels=c('control','fertilization','tomato','pepper','planted','non-planted'))
barplot.data$taxonomy = unlist(rep(asv.filt.abundants.norm.FAMILY.top10[,1],ncol(asv.filt.abundants.norm.FAMILY.top10)-1))
barplot.data$soilroot = c(rep("soil",20*6), rep("root",20*4))
###ggplot
dev.new()
x = colorRampPalette(brewer.pal(12,"Paired"))
p=ggplot() + labs(title = "bacteria",fill = "Taxonomy (family)",y ="Relative abundance of ASVs") +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5, size=14, face="bold")) +
geom_bar(aes(y = fraction, x = treatment, fill = taxonomy),
data = barplot.data,stat="identity") +
scale_fill_manual(values = x(nrow(asv.filt.abundants.norm.FAMILY.top10)))
p + scale_fill_brewer(palette = "Set3") + facet_grid(rows=vars(soilroot))
dev.print(device=pdf, "figures/Figure4a_FAMILY_barplots_bacteria.pdf", onefile=FALSE)
dev.off()
x = colorRampPalette(brewer.pal(12,"Paired"))
library(RColorBrewer)
###ggplot
dev.new()
x = colorRampPalette(brewer.pal(12,"Paired"))
p=ggplot() + labs(title = "bacteria",fill = "Taxonomy (family)",y ="Relative abundance of ASVs") +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5, size=14, face="bold")) +
geom_bar(aes(y = fraction, x = treatment, fill = taxonomy),
data = barplot.data,stat="identity") +
scale_fill_manual(values = x(nrow(asv.filt.abundants.norm.FAMILY.top10))) +
facet_grid(rows=vars(soilroot))
p
dev.print(device=pdf, "figures/Figure4a_FAMILY_barplots_bacteria.pdf", onefile=FALSE)
dev.off()
#prepare ggplot object
temp = asv.filt.abundants.norm.FAMILY[order(rowSums(asv.filt.abundants.norm.FAMILY[,2:11],na.rm=T),decreasing = T),]
temp[is.na(temp[,1]),1] = "unknown"
asv.filt.abundants.norm.FAMILY.top10 = temp[1:20,]
barplot.data = as.data.frame(unlist(asv.filt.abundants.norm.FAMILY.top10[,2:11]))
colnames(barplot.data)[1] = "fraction"
n = nrow(asv.filt.abundants.norm.FAMILY.top10)
barplot.data$treatment = factor(c(rep("control",n),rep("fertilization",n),rep("tomato",n),rep("pepper",n),rep("non-planted",n),rep("planted",n),rep("fertilization",n),rep("control",n),rep("tomato",n),rep("pepper",n)),levels=c('control','fertilization','tomato','pepper','planted','non-planted'))
barplot.data$taxonomy = unlist(rep(asv.filt.abundants.norm.FAMILY.top10[,1],ncol(asv.filt.abundants.norm.FAMILY.top10)-1))
barplot.data$soilroot = factor(c(rep("soil",20*6), rep("root",20*4)),levels = c('soil','root'))
###ggplot
dev.new()
x = colorRampPalette(brewer.pal(12,"Paired"))
p=ggplot() + labs(title = "bacteria",fill = "Taxonomy (family)",y ="Relative abundance of ASVs") +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5, size=14, face="bold")) +
geom_bar(aes(y = fraction, x = treatment, fill = taxonomy),
data = barplot.data,stat="identity") +
scale_fill_manual(values = x(nrow(asv.filt.abundants.norm.FAMILY.top10))) +
facet_grid(rows=vars(soilroot))
p
dev.print(device=pdf, "figures/Figure4a_FAMILY_barplots_bacteria.pdf", onefile=FALSE)
dev.off()
#Figure 4 - barplots -----
#get data and merge it
asv.filt.abundants.norm.FAMILY_r = read.table("results/asv/asv.filt.abundants.norm.FAMILY_fr",stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_s = read.table("results/asv/asv.filt.abundants.norm.FAMILY_fs",stringsAsFactors = F)
asv.filt.abundants.norm.FAMILY = merge(asv.filt.abundants.norm.FAMILY_s,asv.filt.abundants.norm.FAMILY_r,by.x = "taxo.abundants.Family", by.y = "taxo.abundants.Family",all =T)
#prepare ggplot object
temp = asv.filt.abundants.norm.FAMILY[order(rowSums(asv.filt.abundants.norm.FAMILY[,2:11],na.rm=T),decreasing = T),]
temp[is.na(temp[,1]),1] = "unknown"
asv.filt.abundants.norm.FAMILY.top10 = temp[1:20,]
barplot.data = as.data.frame(unlist(asv.filt.abundants.norm.FAMILY.top10[,2:11]))
colnames(barplot.data)[1] = "fraction"
n = nrow(asv.filt.abundants.norm.FAMILY.top10)
barplot.data$treatment = factor(c(rep("control",n),rep("fertilization",n),rep("tomato",n),rep("pepper",n),rep("non-planted",n),rep("planted",n),rep("fertilization",n),rep("control",n),rep("tomato",n),rep("pepper",n)),levels=c('control','fertilization','tomato','pepper','planted','non-planted'))
barplot.data$taxonomy = unlist(rep(asv.filt.abundants.norm.FAMILY.top10[,1],ncol(asv.filt.abundants.norm.FAMILY.top10)-1))
barplot.data$soilroot = factor(c(rep("soil",20*6), rep("root",20*4)),levels = c('soil','root'))
###ggplot
dev.new()
x = colorRampPalette(brewer.pal(12,"Paired"))
p=ggplot() + labs(title = "fungi",fill = "Taxonomy (family)",y ="Relative abundance of ASVs") +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5, size=14, face="bold")) +
geom_bar(aes(y = fraction, x = treatment, fill = taxonomy),
data = barplot.data,stat="identity") +
scale_fill_manual(values = x(nrow(asv.filt.abundants.norm.FAMILY.top10))) +
facet_grid(rows=vars(soilroot))
p
dev.print(device=pdf, "figures/Figure4a_FAMILY_barplots_fungi.pdf", onefile=FALSE)
dev.off()
asv.filt.abundants.norm.FAMILY_r
asv.filt.abundants.norm.FAMILY_s
asv.filt.abundants.norm.FAMILY_r = read.table("results/asv/asv.filt.abundants.norm.FAMILY_fr",stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_s = read.table("results/asv/asv.filt.abundants.norm.FAMILY_fs",stringsAsFactors = F,na.strings = "none"))
asv.filt.abundants.norm.FAMILY_r = read.table("results/asv/asv.filt.abundants.norm.FAMILY_fr",stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_s = read.table("results/asv/asv.filt.abundants.norm.FAMILY_fs",stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_s
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1]
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='NA',-1]
#get data and merge it
asv.filt.abundants.norm.FAMILY_r = read.table("results/asv/asv.filt.abundants.norm.FAMILY_fr",stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_s = read.table("results/asv/asv.filt.abundants.norm.FAMILY_fs",stringsAsFactors = F,na.strings = "none")
#combine NA + unidentified
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_r = asv.filt.abundants.norm.FAMILY_r[-(asv.filt.abundants.norm.FAMILY_r[,1]=='NA'),]
dim(asv.filt.abundants.norm.FAMILY_r)
asv.filt.abundants.norm.FAMILY_r = read.table("results/asv/asv.filt.abundants.norm.FAMILY_fr",stringsAsFactors = F,na.strings = "none")
dim(asv.filt.abundants.norm.FAMILY_r)
asv.filt.abundants.norm.FAMILY_r
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_r = asv.filt.abundants.norm.FAMILY_r[-(asv.filt.abundants.norm.FAMILY_r[,1]=='NA'),]
asv.filt.abundants.norm.FAMILY_r
asv.filt.abundants.norm.FAMILY_r[-(asv.filt.abundants.norm.FAMILY_r[,1]=='NA'),]
asv.filt.abundants.norm.FAMILY_r[-(asv.filt.abundants.norm.FAMILY_r[,1]=NA),]
asv.filt.abundants.norm.FAMILY_r[-(asv.filt.abundants.norm.FAMILY_r[,1]=='NA'),]
asv.filt.abundants.norm.FAMILY_r[-(asv.filt.abundants.norm.FAMILY_r[,1]=='NA'),]
asv.filt.abundants.norm.FAMILY_r = read.table("results/asv/asv.filt.abundants.norm.FAMILY_fr",stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_r
asv.filt.abundants.norm.FAMILY_r[27,1]
asv.filt.abundants.norm.FAMILY_r[27,1] == 'NA'
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_r[27,1] == 'NA'
asv.filt.abundants.norm.FAMILY_r[-(asv.filt.abundants.norm.FAMILY_r[,1]=='NA'),]
asv.filt.abundants.norm.FAMILY_r[(asv.filt.abundants.norm.FAMILY_r[,1]=='NA'),]
asv.filt.abundants.norm.FAMILY_r[27,1] == 'NA'
asv.filt.abundants.norm.FAMILY_r[-nrow(asv.filt.abundants.norm.FAMILY_r),]
asv.filt.abundants.norm.FAMILY_s
asv.filt.abundants.norm.FAMILY_r = read.table("results/asv/asv.filt.abundants.norm.FAMILY_fr",stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_s = read.table("results/asv/asv.filt.abundants.norm.FAMILY_fs",stringsAsFactors = F,na.strings = "none")
#combine NA + unidentified
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_r = asv.filt.abundants.norm.FAMILY_r[-nrow(asv.filt.abundants.norm.FAMILY_r),]
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_s = asv.filt.abundants.norm.FAMILY_s[-nrow(asv.filt.abundants.norm.FAMILY_s),]
asv.filt.abundants.norm.FAMILY = merge(asv.filt.abundants.norm.FAMILY_s,asv.filt.abundants.norm.FAMILY_r,by.x = "taxo.abundants.Family", by.y = "taxo.abundants.Family",all =T)
#prepare ggplot object
temp = asv.filt.abundants.norm.FAMILY[order(rowSums(asv.filt.abundants.norm.FAMILY[,2:11],na.rm=T),decreasing = T),]
temp[is.na(temp[,1]),1] = "unknown"
asv.filt.abundants.norm.FAMILY.top10 = temp[1:20,]
barplot.data = as.data.frame(unlist(asv.filt.abundants.norm.FAMILY.top10[,2:11]))
colnames(barplot.data)[1] = "fraction"
n = nrow(asv.filt.abundants.norm.FAMILY.top10)
barplot.data$treatment = factor(c(rep("control",n),rep("fertilization",n),rep("tomato",n),rep("pepper",n),rep("non-planted",n),rep("planted",n),rep("fertilization",n),rep("control",n),rep("tomato",n),rep("pepper",n)),levels=c('control','fertilization','tomato','pepper','planted','non-planted'))
barplot.data$taxonomy = unlist(rep(asv.filt.abundants.norm.FAMILY.top10[,1],ncol(asv.filt.abundants.norm.FAMILY.top10)-1))
barplot.data$soilroot = factor(c(rep("soil",20*6), rep("root",20*4)),levels = c('soil','root'))
###ggplot
dev.new()
x = colorRampPalette(brewer.pal(12,"Paired"))
p=ggplot() + labs(title = "fungi",fill = "Taxonomy (family)",y ="Relative abundance of ASVs") +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5, size=14, face="bold")) +
geom_bar(aes(y = fraction, x = treatment, fill = taxonomy),
data = barplot.data,stat="identity") +
scale_fill_manual(values = x(nrow(asv.filt.abundants.norm.FAMILY.top10))) +
facet_grid(rows=vars(soilroot))
p
dev.print(device=pdf, "figures/Figure4a_FAMILY_barplots_fungi.pdf", onefile=FALSE)
dev.off()
asv.filt.abundants.norm.FAMILY_r = read.table("results/asv/asv.filt.abundants.norm.FAMILY_br",stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_s = read.table("results/asv/asv.filt.abundants.norm.FAMILY_bs",stringsAsFactors = F,na.strings = "none")
#combine NA + unidentified
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_r = asv.filt.abundants.norm.FAMILY_r[-nrow(asv.filt.abundants.norm.FAMILY_r),]
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_s = asv.filt.abundants.norm.FAMILY_s[-nrow(asv.filt.abundants.norm.FAMILY_s),]
#merge
asv.filt.abundants.norm.FAMILY = merge(asv.filt.abundants.norm.FAMILY_s,asv.filt.abundants.norm.FAMILY_r,by.x = "taxo.abundants.Family", by.y = "taxo.abundants.Family",all =T)
#prepare ggplot object
temp = asv.filt.abundants.norm.FAMILY[order(rowSums(asv.filt.abundants.norm.FAMILY[,2:11],na.rm=T),decreasing = T),]
temp[is.na(temp[,1]),1] = "unknown"
asv.filt.abundants.norm.FAMILY.top10 = temp[1:20,]
barplot.data = as.data.frame(unlist(asv.filt.abundants.norm.FAMILY.top10[,2:11]))
colnames(barplot.data)[1] = "fraction"
n = nrow(asv.filt.abundants.norm.FAMILY.top10)
barplot.data$treatment = factor(c(rep("control",n),rep("fertilization",n),rep("tomato",n),rep("pepper",n),rep("non-planted",n),rep("planted",n),rep("fertilization",n),rep("control",n),rep("tomato",n),rep("pepper",n)),levels=c('control','fertilization','tomato','pepper','planted','non-planted'))
barplot.data$taxonomy = unlist(rep(asv.filt.abundants.norm.FAMILY.top10[,1],ncol(asv.filt.abundants.norm.FAMILY.top10)-1))
barplot.data$soilroot = factor(c(rep("soil",20*6), rep("root",20*4)),levels = c('soil','root'))
###ggplot
dev.new()
x = colorRampPalette(brewer.pal(12,"Paired"))
p=ggplot() + labs(title = "bacteria",fill = "Taxonomy (family)",y ="Relative abundance of ASVs") +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5, size=14, face="bold")) +
geom_bar(aes(y = fraction, x = treatment, fill = taxonomy),
data = barplot.data,stat="identity") +
scale_fill_manual(values = x(nrow(asv.filt.abundants.norm.FAMILY.top10))) +
facet_grid(rows=vars(soilroot))
p
dev.print(device=pdf, "figures/Figure4a_FAMILY_barplots_bacteria.pdf", onefile=FALSE)
dev.off()
temp
temp[,1:2]
asv.filt.abundants.norm.FAMILY_r = read.table("results/asv/asv.filt.abundants.norm.FAMILY_br",stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_s = read.table("results/asv/asv.filt.abundants.norm.FAMILY_bs",stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_r
asv.filt.abundants.norm.FAMILY_s
group = "bacteria"
ifelse(group=="bacteria","b","f")
abr = ifelse(group=="bacteria","b","f")
abr
asv.filt.abundants.norm.FAMILY_r
#Figure 4 - barplots -----
for(group in c("bacteria","fungi"))
{
abr = ifelse(group=="bacteria","b","f")
#get data and merge it
asv.filt.abundants.norm.FAMILY_r = read.table(paste("results/asv/asv.filt.abundants.norm.FAMILY_",abr,"r",sep=""),stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_s = read.table(paste("results/asv/asv.filt.abundants.norm.FAMILY_",abr,"s",sep=""),stringsAsFactors = F,na.strings = "none")
if(group=="bacteria"){
#combine NA + unidentified
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='Unknown_Family',-1] =
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='Unknown_Family',-1] + asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_s = asv.filt.abundants.norm.FAMILY_s[-nrow(asv.filt.abundants.norm.FAMILY_s),]
}
if(group=="fungi"){
#combine NA + unidentified
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_r = asv.filt.abundants.norm.FAMILY_r[-nrow(asv.filt.abundants.norm.FAMILY_r),]
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_s = asv.filt.abundants.norm.FAMILY_s[-nrow(asv.filt.abundants.norm.FAMILY_s),]
}
#merge
asv.filt.abundants.norm.FAMILY = merge(asv.filt.abundants.norm.FAMILY_s,asv.filt.abundants.norm.FAMILY_r,by.x = "taxo.abundants.Family", by.y = "taxo.abundants.Family",all =T)
#prepare ggplot object
temp = asv.filt.abundants.norm.FAMILY[order(rowSums(asv.filt.abundants.norm.FAMILY[,2:11],na.rm=T),decreasing = T),]
temp[is.na(temp[,1]),1] = "unknown"
asv.filt.abundants.norm.FAMILY.top10 = temp[1:20,]
barplot.data = as.data.frame(unlist(asv.filt.abundants.norm.FAMILY.top10[,2:11]))
colnames(barplot.data)[1] = "fraction"
n = nrow(asv.filt.abundants.norm.FAMILY.top10)
barplot.data$treatment = factor(c(rep("control",n),rep("fertilization",n),rep("tomato",n),rep("pepper",n),rep("non-planted",n),rep("planted",n),rep("fertilization",n),rep("control",n),rep("tomato",n),rep("pepper",n)),levels=c('control','fertilization','tomato','pepper','planted','non-planted'))
barplot.data$taxonomy = unlist(rep(asv.filt.abundants.norm.FAMILY.top10[,1],ncol(asv.filt.abundants.norm.FAMILY.top10)-1))
barplot.data$soilroot = factor(c(rep("soil",20*6), rep("root",20*4)),levels = c('soil','root'))
###ggplot
dev.new()
x = colorRampPalette(brewer.pal(12,"Paired"))
p=ggplot() + labs(title = group,fill = "Taxonomy (family)",y ="Relative abundance of ASVs") +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5, size=14, face="bold")) +
geom_bar(aes(y = fraction, x = treatment, fill = taxonomy),
data = barplot.data,stat="identity") +
scale_fill_manual(values = x(nrow(asv.filt.abundants.norm.FAMILY.top10))) +
facet_grid(rows=vars(soilroot))
p
dev.print(device=pdf, paste("figures/Figure4a_FAMILY_barplots_",group,".pdf",sep=""), onefile=FALSE)
dev.off()
}
group
abr = ifelse(group=="bacteria","b","f")
abr
asv.filt.abundants.norm.FAMILY_r = read.table(paste("results/asv/asv.filt.abundants.norm.FAMILY_",abr,"r",sep=""),stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_s = read.table(paste("results/asv/asv.filt.abundants.norm.FAMILY_",abr,"s",sep=""),stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_r
if(group=="fungi"){
#combine NA + unidentified
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_r = asv.filt.abundants.norm.FAMILY_r[-nrow(asv.filt.abundants.norm.FAMILY_r),]
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_s = asv.filt.abundants.norm.FAMILY_s[-nrow(asv.filt.abundants.norm.FAMILY_s),]
}
asv.filt.abundants.norm.FAMILY_r
#merge
asv.filt.abundants.norm.FAMILY = merge(asv.filt.abundants.norm.FAMILY_s,asv.filt.abundants.norm.FAMILY_r,by.x = "taxo.abundants.Family", by.y = "taxo.abundants.Family",all =T)
#prepare ggplot object
temp = asv.filt.abundants.norm.FAMILY[order(rowSums(asv.filt.abundants.norm.FAMILY[,2:11],na.rm=T),decreasing = T),]
temp[is.na(temp[,1]),1] = "unknown"
asv.filt.abundants.norm.FAMILY.top10 = temp[1:20,]
barplot.data = as.data.frame(unlist(asv.filt.abundants.norm.FAMILY.top10[,2:11]))
colnames(barplot.data)[1] = "fraction"
n = nrow(asv.filt.abundants.norm.FAMILY.top10)
barplot.data$treatment = factor(c(rep("control",n),rep("fertilization",n),rep("tomato",n),rep("pepper",n),rep("non-planted",n),rep("planted",n),rep("fertilization",n),rep("control",n),rep("tomato",n),rep("pepper",n)),levels=c('control','fertilization','tomato','pepper','planted','non-planted'))
barplot.data$taxonomy = unlist(rep(asv.filt.abundants.norm.FAMILY.top10[,1],ncol(asv.filt.abundants.norm.FAMILY.top10)-1))
barplot.data$soilroot = factor(c(rep("soil",20*6), rep("root",20*4)),levels = c('soil','root'))
dev.new()
x = colorRampPalette(brewer.pal(12,"Paired"))
p=ggplot() + labs(title = group,fill = "Taxonomy (family)",y ="Relative abundance of ASVs") +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5, size=14, face="bold")) +
geom_bar(aes(y = fraction, x = treatment, fill = taxonomy),
data = barplot.data,stat="identity") +
scale_fill_manual(values = x(nrow(asv.filt.abundants.norm.FAMILY.top10))) +
facet_grid(rows=vars(soilroot))
p
dev.print(device=pdf, paste("figures/Figure4a_FAMILY_barplots_",group,".pdf",sep=""), onefile=FALSE)
dev.off()
group = "bacteria"
abr = ifelse(group=="bacteria","b","f")
#get data and merge it
asv.filt.abundants.norm.FAMILY_r = read.table(paste("results/asv/asv.filt.abundants.norm.FAMILY_",abr,"r",sep=""),stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_s = read.table(paste("results/asv/asv.filt.abundants.norm.FAMILY_",abr,"s",sep=""),stringsAsFactors = F,na.strings = "none")
if(group=="bacteria"){
#combine NA + unidentified
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='Unknown_Family',-1] =
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='Unknown_Family',-1] + asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_s = asv.filt.abundants.norm.FAMILY_s[-nrow(asv.filt.abundants.norm.FAMILY_s),]
}
if(group=="fungi"){
#combine NA + unidentified
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_r = asv.filt.abundants.norm.FAMILY_r[-nrow(asv.filt.abundants.norm.FAMILY_r),]
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_s = asv.filt.abundants.norm.FAMILY_s[-nrow(asv.filt.abundants.norm.FAMILY_s),]
}
#merge
asv.filt.abundants.norm.FAMILY = merge(asv.filt.abundants.norm.FAMILY_s,asv.filt.abundants.norm.FAMILY_r,by.x = "taxo.abundants.Family", by.y = "taxo.abundants.Family",all =T)
#prepare ggplot object
temp = asv.filt.abundants.norm.FAMILY[order(rowSums(asv.filt.abundants.norm.FAMILY[,2:11],na.rm=T),decreasing = T),]
temp[is.na(temp[,1]),1] = "unknown"
asv.filt.abundants.norm.FAMILY.top10 = temp[1:20,]
barplot.data = as.data.frame(unlist(asv.filt.abundants.norm.FAMILY.top10[,2:11]))
colnames(barplot.data)[1] = "fraction"
n = nrow(asv.filt.abundants.norm.FAMILY.top10)
barplot.data$treatment = factor(c(rep("control",n),rep("fertilization",n),rep("tomato",n),rep("pepper",n),rep("non-planted",n),rep("planted",n),rep("fertilization",n),rep("control",n),rep("tomato",n),rep("pepper",n)),levels=c('control','fertilization','tomato','pepper','planted','non-planted'))
barplot.data$taxonomy = unlist(rep(asv.filt.abundants.norm.FAMILY.top10[,1],ncol(asv.filt.abundants.norm.FAMILY.top10)-1))
barplot.data$soilroot = factor(c(rep("soil",20*6), rep("root",20*4)),levels = c('soil','root'))
###ggplot
dev.new()
x = colorRampPalette(brewer.pal(12,"Paired"))
p=ggplot() + labs(title = group,fill = "Taxonomy (family)",y ="Relative abundance of ASVs") +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5, size=14, face="bold")) +
geom_bar(aes(y = fraction, x = treatment, fill = taxonomy),
data = barplot.data,stat="identity") +
scale_fill_manual(values = x(nrow(asv.filt.abundants.norm.FAMILY.top10))) +
facet_grid(rows=vars(soilroot))
p
dev.print(device=pdf, paste("figures/Figure4a_FAMILY_barplots_",group,".pdf",sep=""), onefile=FALSE)
dev.off()
for(group in c("bacteria","fungi"))
{
abr = ifelse(group=="bacteria","b","f")
#get data and merge it
asv.filt.abundants.norm.FAMILY_r = read.table(paste("results/asv/asv.filt.abundants.norm.FAMILY_",abr,"r",sep=""),stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_s = read.table(paste("results/asv/asv.filt.abundants.norm.FAMILY_",abr,"s",sep=""),stringsAsFactors = F,na.strings = "none")
if(group=="bacteria"){
#combine NA + unidentified
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='Unknown_Family',-1] =
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='Unknown_Family',-1] + asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_s = asv.filt.abundants.norm.FAMILY_s[-nrow(asv.filt.abundants.norm.FAMILY_s),]
}
if(group=="fungi"){
#combine NA + unidentified
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_r = asv.filt.abundants.norm.FAMILY_r[-nrow(asv.filt.abundants.norm.FAMILY_r),]
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_s = asv.filt.abundants.norm.FAMILY_s[-nrow(asv.filt.abundants.norm.FAMILY_s),]
}
#merge
asv.filt.abundants.norm.FAMILY = merge(asv.filt.abundants.norm.FAMILY_s,asv.filt.abundants.norm.FAMILY_r,by.x = "taxo.abundants.Family", by.y = "taxo.abundants.Family",all =T)
#prepare ggplot object
temp = asv.filt.abundants.norm.FAMILY[order(rowSums(asv.filt.abundants.norm.FAMILY[,2:11],na.rm=T),decreasing = T),]
temp[is.na(temp[,1]),1] = "unknown"
asv.filt.abundants.norm.FAMILY.top10 = temp[1:20,]
barplot.data = as.data.frame(unlist(asv.filt.abundants.norm.FAMILY.top10[,2:11]))
colnames(barplot.data)[1] = "fraction"
n = nrow(asv.filt.abundants.norm.FAMILY.top10)
barplot.data$treatment = factor(c(rep("control",n),rep("fertilization",n),rep("tomato",n),rep("pepper",n),rep("non-planted",n),rep("planted",n),rep("fertilization",n),rep("control",n),rep("tomato",n),rep("pepper",n)),levels=c('control','fertilization','tomato','pepper','planted','non-planted'))
barplot.data$taxonomy = unlist(rep(asv.filt.abundants.norm.FAMILY.top10[,1],ncol(asv.filt.abundants.norm.FAMILY.top10)-1))
barplot.data$soilroot = factor(c(rep("soil",20*6), rep("root",20*4)),levels = c('soil','root'))
###ggplot
dev.new()
x = colorRampPalette(brewer.pal(12,"Paired"))
p=ggplot() + labs(title = group,fill = "Taxonomy (family)",y ="Relative abundance of ASVs") +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5, size=14, face="bold")) +
geom_bar(aes(y = fraction, x = treatment, fill = taxonomy),
data = barplot.data,stat="identity") +
scale_fill_manual(values = x(nrow(asv.filt.abundants.norm.FAMILY.top10))) +
facet_grid(rows=vars(soilroot))
p
dev.print(device=pdf, paste("figures/Figure4a_FAMILY_barplots_",group,".pdf",sep=""), onefile=FALSE)
dev.off()
}
group
abr = ifelse(group=="bacteria","b","f")
#get data and merge it
asv.filt.abundants.norm.FAMILY_r = read.table(paste("results/asv/asv.filt.abundants.norm.FAMILY_",abr,"r",sep=""),stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_s = read.table(paste("results/asv/asv.filt.abundants.norm.FAMILY_",abr,"s",sep=""),stringsAsFactors = F,na.strings = "none")
if(group=="bacteria"){
#combine NA + unidentified
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='Unknown_Family',-1] =
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='Unknown_Family',-1] + asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_s = asv.filt.abundants.norm.FAMILY_s[-nrow(asv.filt.abundants.norm.FAMILY_s),]
}
if(group=="fungi"){
#combine NA + unidentified
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_r = asv.filt.abundants.norm.FAMILY_r[-nrow(asv.filt.abundants.norm.FAMILY_r),]
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_s = asv.filt.abundants.norm.FAMILY_s[-nrow(asv.filt.abundants.norm.FAMILY_s),]
}
#merge
asv.filt.abundants.norm.FAMILY = merge(asv.filt.abundants.norm.FAMILY_s,asv.filt.abundants.norm.FAMILY_r,by.x = "taxo.abundants.Family", by.y = "taxo.abundants.Family",all =T)
#prepare ggplot object
temp = asv.filt.abundants.norm.FAMILY[order(rowSums(asv.filt.abundants.norm.FAMILY[,2:11],na.rm=T),decreasing = T),]
temp[is.na(temp[,1]),1] = "unknown"
asv.filt.abundants.norm.FAMILY.top10 = temp[1:20,]
barplot.data = as.data.frame(unlist(asv.filt.abundants.norm.FAMILY.top10[,2:11]))
colnames(barplot.data)[1] = "fraction"
n = nrow(asv.filt.abundants.norm.FAMILY.top10)
barplot.data$treatment = factor(c(rep("control",n),rep("fertilization",n),rep("tomato",n),rep("pepper",n),rep("non-planted",n),rep("planted",n),rep("fertilization",n),rep("control",n),rep("tomato",n),rep("pepper",n)),levels=c('control','fertilization','tomato','pepper','planted','non-planted'))
barplot.data$taxonomy = unlist(rep(asv.filt.abundants.norm.FAMILY.top10[,1],ncol(asv.filt.abundants.norm.FAMILY.top10)-1))
barplot.data$soilroot = factor(c(rep("soil",20*6), rep("root",20*4)),levels = c('soil','root'))
###ggplot
dev.new()
x = colorRampPalette(brewer.pal(12,"Paired"))
p=ggplot() + labs(title = group,fill = "Taxonomy (family)",y ="Relative abundance of ASVs") +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5, size=14, face="bold")) +
geom_bar(aes(y = fraction, x = treatment, fill = taxonomy),
data = barplot.data,stat="identity") +
scale_fill_manual(values = x(nrow(asv.filt.abundants.norm.FAMILY.top10))) +
facet_grid(rows=vars(soilroot))
p
dev.print(device=pdf, paste("figures/Figure4a_FAMILY_barplots_",group,".pdf",sep=""), onefile=FALSE)
dev.off()
group
group = "bacteria"
abr = ifelse(group=="bacteria","b","f")
#get data and merge it
asv.filt.abundants.norm.FAMILY_r = read.table(paste("results/asv/asv.filt.abundants.norm.FAMILY_",abr,"r",sep=""),stringsAsFactors = F,na.strings = "none")
asv.filt.abundants.norm.FAMILY_s = read.table(paste("results/asv/asv.filt.abundants.norm.FAMILY_",abr,"s",sep=""),stringsAsFactors = F,na.strings = "none")
if(group=="bacteria"){
#combine NA + unidentified
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='Unknown_Family',-1] =
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='Unknown_Family',-1] + asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_s = asv.filt.abundants.norm.FAMILY_s[-nrow(asv.filt.abundants.norm.FAMILY_s),]
}
if(group=="fungi"){
#combine NA + unidentified
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_r[asv.filt.abundants.norm.FAMILY_r[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_r = asv.filt.abundants.norm.FAMILY_r[-nrow(asv.filt.abundants.norm.FAMILY_r),]
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='unidentified',-1] =
asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='unidentified',-1] + asv.filt.abundants.norm.FAMILY_s[asv.filt.abundants.norm.FAMILY_s[,1]=='NA',-1]
asv.filt.abundants.norm.FAMILY_s = asv.filt.abundants.norm.FAMILY_s[-nrow(asv.filt.abundants.norm.FAMILY_s),]
}
#merge
asv.filt.abundants.norm.FAMILY = merge(asv.filt.abundants.norm.FAMILY_s,asv.filt.abundants.norm.FAMILY_r,by.x = "taxo.abundants.Family", by.y = "taxo.abundants.Family",all =T)
#prepare ggplot object
temp = asv.filt.abundants.norm.FAMILY[order(rowSums(asv.filt.abundants.norm.FAMILY[,2:11],na.rm=T),decreasing = T),]
temp[is.na(temp[,1]),1] = "unknown"
asv.filt.abundants.norm.FAMILY.top10 = temp[1:20,]
barplot.data = as.data.frame(unlist(asv.filt.abundants.norm.FAMILY.top10[,2:11]))
colnames(barplot.data)[1] = "fraction"
n = nrow(asv.filt.abundants.norm.FAMILY.top10)
barplot.data$treatment = factor(c(rep("control",n),rep("fertilization",n),rep("tomato",n),rep("pepper",n),rep("non-planted",n),rep("planted",n),rep("fertilization",n),rep("control",n),rep("tomato",n),rep("pepper",n)),levels=c('control','fertilization','tomato','pepper','planted','non-planted'))
barplot.data$taxonomy = unlist(rep(asv.filt.abundants.norm.FAMILY.top10[,1],ncol(asv.filt.abundants.norm.FAMILY.top10)-1))
barplot.data$soilroot = factor(c(rep("soil",20*6), rep("root",20*4)),levels = c('soil','root'))
###ggplot
dev.new()
x = colorRampPalette(brewer.pal(12,"Paired"))
p=ggplot() + labs(title = group,fill = "Taxonomy (family)",y ="Relative abundance of ASVs") +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5, size=14, face="bold")) +
geom_bar(aes(y = fraction, x = treatment, fill = taxonomy),
data = barplot.data,stat="identity") +
scale_fill_manual(values = x(nrow(asv.filt.abundants.norm.FAMILY.top10))) +
facet_grid(rows=vars(soilroot))
p
dev.print(device=pdf, paste("figures/Figure4a_FAMILY_barplots_",group,".pdf",sep=""), onefile=FALSE)
dev.off()
